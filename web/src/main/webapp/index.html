<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Red Hat Catapult</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script language="JavaScript">
    $(document).ready(function() {
      var appstoreURL = "https://raw.githubusercontent.com/redhat-kontinuity/appstore/master/appstore.json";
      console.log("Obtaining app store metadata from: " + appstoreURL);

      // Populate the available options from the appstore JSON
      $.getJSON(appstoreURL)
        .done(function(json){
          console.log("Got appstore data: "+ json);
          $.each(json.repositories, function(i,repository){
            var repositoryName = repository.name;
            var openshiftTemplateFile = repository["openshift-template-file"];
            $("#flingSourceRepo").append(
              $("<option>").attr("value", repositoryName)
                .attr("data-openshift_template_file", openshiftTemplateFile)
                  .text(repositoryName)
            );
          })
        })
        .fail(function(jqxhr, textStatus, error){
          console.log("Could not fetch AppStore metadata: " + textStatus);
        });

        // Change the hidden field for the openshiftTemplateFile depending upon the selected option
        $("#flingSourceRepo").change(function () {
        var openshiftTemplateFile = $(this).find('option:selected').attr('data-openshift_template_file');
        $("#openshiftTemplateFile").val(openshiftTemplateFile);
        });
    });
    </script>
</head>
<body>
<h1>Catapult</h1>
<form id="flingForm" action="api/catapult/fling" method="get">
    <select required="true" id="flingSourceRepo" name="source_repo" form="flingForm">
        <option value="">Select an option below</option>
    </select>
    <input type="hidden" id="openshiftTemplateFile" name="openshift_template_file">
    <input id="flingSubmitButton" type="submit">
</form>

</body>
</html>
